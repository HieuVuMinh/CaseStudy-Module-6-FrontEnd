<app-navbar-board-header [board]="board"
                         [members]="members"
                         [canEdit]="canEdit"
                         [isInWorkspace]="isInWorkspace"></app-navbar-board-header>
<!--main content-->
<div class="root">
  <div class="board">
    <div class="board-wrapper">
      <div class="board-columns">

        <div cdkDropList
             cdkDropListGroup
             cdkDropListOrientation="horizontal" class="board-columns"
             (cdkDropListDropped)="dropColumn($event)">
          <div cdkDragLockAxis="x" class="board-column"
               *ngFor="let column of board.columns; index as i" cdkDrag>
            <div class="window-close" (click)="closeColumn(column.id)">
              <i class="far fa-window-close" disabled></i>
            </div>
            <div class="column-title" cdkDragHandle>
              <input class="input title-column" type="text" style="border: none; position: revert"
                     (keydown)="onKeydown($event, column)"
                     [(ngModel)]="this.board.columns[i].title"
                     value="{{column.title}}">
            </div>
            <!--            content-->
            <div class="tasks-container"
                 style="min-height: 410px"
                 id="{{column.id}}"
                 cdkDropList
                 [cdkDropListData]="column.cards"
                 (cdkDropListDropped)="dropCard($event)">
              <div class="task" *ngFor="let item of column.cards" cdkDrag (click)="showUpdateModal(item)">
                <ul>
                  <li><span *ngFor="let tag of item.tags" class="tag is-light" [ngClass]="tag.color">{{tag.name}}</span>
                  </li>
                  <li><span style="padding-left: 5px">{{item.title}}</span></li>
                </ul>
              </div>
              <div class="form-create-new-card is-hidden" id="new-card-form-col-{{column.id}}">
                <form #showAddNewCardForm="ngForm"
                      (ngSubmit)="addNewCard(column.id,column.cards?.length,showAddNewCardForm)">
                  <input type="text" name="title" #addCard="ngModel" class="input" [(ngModel)]="newCard.title"
                         placeholder="Title..." minlength="4" required>
                  <td *ngIf="showAddNewCardForm.invalid && addCard.touched && isAdded">
                    <p class="notification is-danger is-light" *ngIf="addCard.errors?.required">Can not blank</p>
                    <p class="notification is-danger is-light" *ngIf="addCard.errors?.minlength">At least 4
                      characters</p>
                  </td>
                  <div class="button-option">
                    <button class="button add-new-card is-primary is-light" type="submit">
                      Add card
                    </button>
                    <button class="button is-danger is-light " (click)="hiddenInputAddNewCard(column.id)" type="button">
                      Cancel
                    </button>
                  </div>
                </form>
              </div>
              <div id="show-form-create-new-card-{{column.id}}" class="show-form-create-new-card">
                <button class="button is-light" (click)="showInputAddNewCard(column.id)"> + Add new card</button>
              </div>
            </div>
          </div>
        </div>
        <div class="board-columns-add" *ngIf="canEdit">
          <div class="board-column" style="margin-left: 0px">
            <div class="column-title">
              <form [formGroup]="columnForm" (ngSubmit)="addColumn()">
                <input class="input add-column-input" type="text" formControlName="title" style="position: revert"
                       placeholder="Enter title column..." maxlength="512">
                <div class="button-create-column">
                  <button style="position: revert" [disabled]="columnForm.invalid" class="button is-primary is-light"
                          type="submit">Add column
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!--Modal update card-->
<div id="modal-update-card" class="modal">
  <div class="modal-background" (click)="closeUpdateModal()"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <input class="input modal-card-title" type="text" placeholder="Title" [(ngModel)]="selectedCard.title">
    </header>
    <section class="modal-card-body">
      <div class="columns">
        <div class="column">
          <div>
        <span *ngFor="let tag of selectedCard.tags" class="tag is-light" [ngClass]="tag.color"
              (click)="removeTagFromCard(tag)">{{tag.name}}</span>
          </div>
          <div class="model-card-body-content">
            <input class="input modal-card-content" type="text" placeholder="Content..."
                   [(ngModel)]="selectedCard.content">
          </div>
          <div class="model-card-body-upload-file">
            <div class="file">
              <label class="file-label">
                <input class="file-input" type="file" name="resume">
                <span class="file-cta">
              <span class="file-icon">
                <i class="fas fa-upload"></i>
              </span>
              <span class="file-label">
                Attachment
              </span>
            </span>
              </label>
            </div>
          </div>
        </div>
        <div class="column is-one-quarter">
          <div id="tag-section" class="">
            <span>Tags</span>
            <ul>
              <li *ngFor="let tag of this.board.tags"
                  (mouseover)="showDeleteTagButton(tag.id)"
                  (mouseout)="hideDeleteTagButton(tag.id)">
                <span class="tag is-light" [ngClass]="tag.color"
                      (click)="addTagToCard(tag)">{{tag.name}}
                </span>
                <a (click)="deleteTag(tag.id)"><span class="tag is-danger is-hidden" id="delete-btn-tag-{{tag.id}}"><i class="far fa-trash-alt"></i></span></a>
              </li>
            </ul>
            <span style="font-size: small">Add new tag:</span>
            <input class="input is-info is-small" [(ngModel)]="newTag.name" #newTagName="ngModel" required type="text"
                   placeholder="Tag name">
            <div *ngIf="newTagName.invalid" class="alert">
              <div *ngIf="newTagName.errors?.required">
                <span style="font-size: x-small">Tag name is required.</span>
              </div>
            </div>
            <div class="select is-small">
              <select [(ngModel)]="newTag.color">
                <div class="is-primary"></div>
                <option value="is-primary" style="color: lightgreen; background-color: rgb(235, 255, 252)">Light Green</option>
                <option value="is-link" style="color: darkblue; background-color: rgb(239, 241, 250)">Dark Blue</option>
                <option value="is-info" style="color: lightblue; background-color: rgb(239, 245, 251)">Light Blue</option>
                <option value="is-success" style="color: darkgreen; background-color: rgb(239, 250, 245)">Dark Green</option>
                <option value="is-warning" style="color: yellow; background-color: rgb(255, 250, 235)">Yellow</option>
                <option value="is-danger" style="color: red; background-color: rgb(254, 236, 240)">Red</option>
              </select>
            </div>
            <button *ngIf="newTagName.valid" class="button is-info is-light is-small" (click)="addNewTag()">Add tag</button>
            <button *ngIf="newTagName.invalid" class="button is-info is-light is-small" disabled>Add tag</button>
          </div>
        </div>
      </div>
    </section>
    <footer class="modal-card-foot">
      <button class="button is-success" (click)="updateCurrentCard()">Save changes</button>
      <button class="button" (click)="closeUpdateModal()">Cancel</button>
    </footer>
  </div>
</div>
